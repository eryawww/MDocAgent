[
  "Variational Transformers for Diverse Response Generation Zhaojiang Lin\u2020, Genta Indra Winata, Peng Xu, Zihan Liu, Pascale Fung Center for Arti\ufb01cial Intelligence Research (CAiRE) Department of Electronic and Computer Engineering The Hong Kong University of Science and Technology, Clear Water Bay, Hong Kong \u2020zlinao@connect.ust.hk Abstract Despite the great promise of Transformers in many sequence modeling tasks (e.g., machine translation), their deterministic nature hinders them from generalizing to high entropy tasks such as dialogue response generation. Previ- ous work proposes to capture the variability of dialogue responses with a recurrent neural net- work (RNN)-based conditional variational au- toencoder (CVAE). However, the autoregres- sive computation of the RNN limits the train- ing ef\ufb01ciency. Therefore, we propose the Vari- ational Transformer (VT), a variational self- attentive feed-forward sequence model. The VT combines the parallelizability and global receptive \ufb01eld of the Transformer with the variational nature of the CVAE by incorpo- rating stochastic latent variables into Trans- formers.",
  "The VT combines the parallelizability and global receptive \ufb01eld of the Transformer with the variational nature of the CVAE by incorpo- rating stochastic latent variables into Trans- formers. We explore two types of the VT: 1) modeling the discourse-level diversity with a global latent variable; and 2) augmenting the Transformer decoder with a sequence of \ufb01ne-grained latent variables. Then, the pro- posed models are evaluated on three conversa- tional datasets with both automatic metric and human evaluation. The experimental results show that our models improve standard Trans- formers and other baselines in terms of diver- sity, semantic relevance, and human judgment. 1 Introduction Convolutional and fully-attentional feed-forward architectures, such as Transformers (Vaswani et al., 2017), have emerged as effective alternatives to RNNs (Dehghani et al., 2018) in wide range of NLP tasks. These architectures remove the compu- tational temporal dependency during the training and effectively address the long-standing vanish- ing gradients problem of recurrent models by pro- cessing all inputs simultaneously.",
  "These architectures remove the compu- tational temporal dependency during the training and effectively address the long-standing vanish- ing gradients problem of recurrent models by pro- cessing all inputs simultaneously. Notably, trans- formers apply a fully attention strategy, where each token in the sequence is informed by other tokens via a self-attention mechanism. It acts as an ef- fectively global receptive \ufb01eld across the whole sequences which absence in RNNs. Despite the powerful modeling capability of trasnformers, they often fail to model one-to-many 1 relation in dia- logue response generation tasks (Zhao et al., 2017) due to their deterministic nature. As a result, they generate dull and generic response (e.g., \u201cI am not sure\u201d), especially with greedy and beam search, which are widely used in other sequence modeling tasks. There have been attempts to generate di- verse and informative dialogue responses by incor- porating latent variable(s) into the RNN encoder- decoder architecture. In particular Zhao et al. (2017) adapt a conditional variational autoencoder (CVAE) to capture discourse-level variations of dia- logue, while Goyal et al.",
  "In particular Zhao et al. (2017) adapt a conditional variational autoencoder (CVAE) to capture discourse-level variations of dia- logue, while Goyal et al. (2017) and Du et al. (2018) integrates latent variables in the hidden states of the RNN decoder. However, the inherently sequential computation of aforementioned models limit the ef\ufb01ciency for large scale training. In this paper, we introduce the Variational Trans- former (VT) 2 a variational self-attentive feed- forward sequence model to address the aforemen- tioned issues. The VT combine the parallelizability and global receptive \ufb01eld of the transformer with the variational nature of CVAE by incorporating stochastic latent variables into transformers. We explore two types of VT: 1) Global Variational Transformer (GVT), and 2) Sequential Variational Transformer. The GVT is the extension of CVAE in Zhao et al.",
  "We explore two types of VT: 1) Global Variational Transformer (GVT), and 2) Sequential Variational Transformer. The GVT is the extension of CVAE in Zhao et al. (2017), which modeling the discourse- level diversity with a global latent variable, While SVT, inspired by variational autoregressive mod- els (Goyal et al., 2017; Du et al., 2018), incor- porates a sequence of latent variables into decod- 1Given a similar dialogue history, there may exist many valid responses. 2The source code is available in https://github. com/zlinao/Variational-Transformer arXiv:2003.12738v1  [cs.CL]  28 Mar 2020",
  "ing process by using a novel variational decoder layer. Unlike previous approaches (Zhao et al., 2017; Goyal et al., 2017; Du et al., 2018), SVT uses Non-causal Multi-head Attention, which at- tend to future tokens for computing posterior latent variables instead of using an additional encoder. The proposed VT architectures integrate stochas- tic latent variables into Transformers. The ex- perimental results on a three conversation dataset demonstrate that our models can generate more informative and coherent responses. 2 Related work 2.1 Neural Conversational Models Conversational systems has been widely stud- ied (Weizenbaum et al., 1966; Wallace, 2009; Vinyals and Le, 2015; Serban et al., 2016). Com- pare to rule-based systems (Weizenbaum et al., 1966; Wallace, 2009), sequence-to-sequence con- versation models achieve superior performance in terms of scalable training and generalization abil- ity (Vinyals and Le, 2015).",
  "Com- pare to rule-based systems (Weizenbaum et al., 1966; Wallace, 2009), sequence-to-sequence con- versation models achieve superior performance in terms of scalable training and generalization abil- ity (Vinyals and Le, 2015). However, it has been pointed out that encoder-decoder models tend to generate generic and repetitive responses like \u201cI am sorry\u201d (Li et al., 2016a). To address this issue, there have been three main lines of work. The \ufb01rst is adding additional information (e.g., persona) as input to guild model generate more informative responses (Li et al., 2016b; Zhang et al., 2018). The second modi\ufb01es the learning objective to pro- mote more diverse generation (Li et al., 2016a), and the third integrates stochastic latent variables into Seq2Seq models by using the CVAE framework (Serban et al., 2017; Zhao et al., 2017). Our work comes within this third line introducing a novel model, the Variational Transformer, to improve di- alogue response generation.",
  "Our work comes within this third line introducing a novel model, the Variational Transformer, to improve di- alogue response generation. 2.2 Conditional Variational Autoencoders Many works have attempted to combine CVAEs with encoder-decoder architectures for sequence generation tasks. Zhang et al. (2016) propose a vari- ational encoder-decoder model for neural machine translation, while Li et al. (2017) apply variational recurrent neural networks (VRNN) (Chung et al., 2015) for text summarization. Zhao et al. (2017) and Zhou and Wang (2018) explore incorporating meta features into CVAE framework in dialogue response generation tasks. (Goyal et al., 2017) and (Du et al., 2018) propose variational autoregressive decoders which enhanced by highly multi-modal latent variables to capture the high variability in di- alogue responses. Le et al. (2018) further augment variational autoregressive decoders with dynamic memory networks for improving generation quality. We unify the previous successful ideas of CVAE, and explore the combinations of CVAE and Trans- former.",
  "Le et al. (2018) further augment variational autoregressive decoders with dynamic memory networks for improving generation quality. We unify the previous successful ideas of CVAE, and explore the combinations of CVAE and Trans- former. 2.3 Fully Attentional Networks Taking advantage of the parallel-in-time structure and global receptive \ufb01eld, Transformers (Vaswani et al., 2017) have recently been shown to achieve impressive results on various sequence modeling tasks. Based on this, several follow-up models have been presented. The Image Transformer (Par- mar et al., 2018) has been proposed for im- age generation, while the MultiModel (Kaiser et al., 2017) integrates convolution, attention and sparsely-gated mixture-of-expert blocks into a sin- gle deep-learning model for simultaneously learn- ing multiple tasks from various domains. Lin et al. (2019) proposed a fully attentional mixture- of-expert model (MoEL) for empathetic dialogue modeling.",
  "Lin et al. (2019) proposed a fully attentional mixture- of-expert model (MoEL) for empathetic dialogue modeling. The Universal Transformer (Dehghani et al., 2018) incorporates the recurrent inductive bias of RNNs into the standard Transformer, and achieves better result on a wide range of algorith- mic and language understanding tasks. Kaiser et al. (2018) introduce the Latent Transformer (LT) for non-autoregressive machine translation. During training, the LT \ufb01rst autoencodes a target sequence into a shorter sequence discrete latent variables. Then a parallel decoder decodes the target using discrete latent variables and an input sequence. Dif- ferent from the LT (Kaiser et al., 2018), the VT generates continuous latent variables during the decoding process.",
  "Then a parallel decoder decodes the target using discrete latent variables and an input sequence. Dif- ferent from the LT (Kaiser et al., 2018), the VT generates continuous latent variables during the decoding process. 3 Preliminaries 3.1 Conditional Variational Autoencoder for Dialogue Generation The CVAE framework (Sohn et al., 2015) repre- sents a dyadic conversation via three random vari- ables: the input condition c, including conversation context and meta features (meta features can be ignored when not available); a latent variable z; and the target response x. A CVAE can be ef\ufb01- ciently trained with Stochastic Gradient Variational Bayes (SGVB) (Kingma and Welling, 2013) by maximizing the variational lower bound of x given",
  "c, according to: p(x|c) = Z z p(x|z, c)p(z|c)dz. (1) The typical CVAE consists of a prior network p\u03b8(z|c), which is used to approximate p(z|c), a recognition network p\u03c6(z|c, x), which is used to approximate posterior distribution q(z|c, x), and a decoder p\u03b8(x|z, c), which is used to approxi- mate p(x|z, c). By assuming z follows multivariate Gaussian distribution with a diagonal co-variance matrix, the evidence lower bound (ELBO) can be written as LELBO = LREC \u2212LKL = Eq\u03c6(z|c,x) [log p\u03b8(x|z, c)] \u2212KL (q\u03c6(z|c, x)\u2225p\u03b8(z|c)) \u2264log p(x|c), (2) where LREC denotes the reconstruction loss and LKL denotes the Kullback-Leibler (KL) diver- gence between the posterior and prior.",
  "In dialogue generation tasks, previous works (Zhao et al., 2017; Zhou and Wang, 2018) apply RNN encoders (with GRU or LSTM cell) to en- code dialogue contexts and responses separately. The condition c is represented by the concatenation of the last hidden state of the context encoder and the meta features (e.g., topic, emotion), while the response x is represented by the last hidden state of response encoder. Then the prior network p\u03b8(z|c) and the recognition network p\u03c6(z|c, x) parameter- ized by multi-layer perceptrons (MLPs) are applied to approximate the means and the log variances of the prior latent distribution N \u0000z; \u00b5\u2032, \u03c3\u20322I \u0001 and posterior latent distribution N \u0000z; \u00b5, \u03c32I \u0001 . With the reparameterization trick (Kingma and Welling, 2013), we can obtain samples of the prior latent variable (for testing) from N \u0000z; \u00b5\u2032, \u03c3\u20322I \u0001 and sam- ples of the posterior latent variable (for training) from N \u0000z; \u00b5, \u03c32I \u0001 .",
  "Finally, an RNN decoder use z and c as the initial state to predicts the response x. The vanishing latent variable problem (Bow- man et al., 2016) is a common issue in RNN-based CVAEs. That is, the powerful autoregressive RNN decoder \ufb01rst learns to ignore the latent variable, and decodes the response by only condition on the previous tokens. Thus the latent variable fails to encode the meaningful information, and the CVAE deteriorates to seq2seq model. To alleviate this issue, KL annealing (Bowman et al., 2016) and \u00a0 \u00a0 Context TRS Decoder Response z z SOS Generation Recognition Net Prior\u00a0Net Context TRS Encoder CLS Response TRS Encoder CLS Attention Mechanism Train only Train & Test Figure 1: The Global Variational Transformer. During training, The posterior latent variable z by the posterior network is passed to the decoder, while during testing, the target response is absent, and z is replaced by the prior latent variable.",
  "During training, The posterior latent variable z by the posterior network is passed to the decoder, while during testing, the target response is absent, and z is replaced by the prior latent variable. The word embeddings, positional encoding, softmax layer and meta vectors are ignored for simplicity bag-of-word loss (Zhao et al., 2017) have been pro- posed, and have shown effectiveness in various dialogue tasks (Zhao et al., 2017; Zhou and Wang, 2018). 3.2 CVAE with Transformer The aforementioned RNN-based CVAE framework integrate the latent variable into the initial state of RNN decoder, while in transformer, it is more \ufb02ex- ible to incorporate the latent variable embedding into the \ufb01rst input token of the decoder to generate the initial state. The overall architecture of GVT is depicted in Figure 1. Different from RNNs, the Transformer encoder maps an input sequence of symbol repre- sentations to a sequence of contextualized represen- tations (Vaswani et al., 2017).",
  "The overall architecture of GVT is depicted in Figure 1. Different from RNNs, the Transformer encoder maps an input sequence of symbol repre- sentations to a sequence of contextualized represen- tations (Vaswani et al., 2017). In order to get \ufb01xed dimension representations of the response and con- text, we add a special token CLS at the beginning of the input sequence as in BERT (Devlin et al., 2018), to compute the weighted sum of the output representations via self-attention. Thus the output representation of the token CLS is considered as the representation of the whole sequence. Then we introduce a recognition network and a prior network to compute the posterior latent variable and prior latent variable as in (Zhao et al., 2017; Zhou and Wang, 2018). We add the latent vari- able sample z and meta features m (can be ignored",
  "when not available) into eSOS, the embedding of the start-of-sequence token SOS: e\u2032 SOS = z + m + eSOS. (3) Finally, the transformer decoder decodes the re- sponse x sequentially while attending to the new embedding e\u2032 SOS of token SOS with latent infor- mation. This design enhances the CVAE framework with the global receptive \ufb01eld, and each position of the GVT can directly access the latent information via the multi-head self-attention mechanism. However, we still observe that the GVT suffers the vanishing latent variable problem as RNN-based CVAE be- cause the decoder can bypass the latent information by paying less attention to the SOS token. Hence, we apply the KL annealing, and bag-of-word aux- iliary loss Lbow as in (Zhao et al., 2017; Zhou and Wang, 2018) to preserve the useful information of the latent variable. Therefore, the learning objec- tive of the GVT is de\ufb01ned as follows: L = LELBO + Lbow.",
  "Therefore, the learning objec- tive of the GVT is de\ufb01ned as follows: L = LELBO + Lbow. (4) 4 Sequential Variational Transformer In order to augment the capacity of the latent vari- able with multi-modal distributions and to better utilize the latent information, we further explore incorporating a sequence of latent variables in de- coding process. We introduce Sequential Varia- tional Transformer (SVT) with a novel variational decoder layer which generate latent variables for each position: z = (z1, . . . , zT ). Similar to Goyal et al. (2017), we interpret the latent variables as a generation plan for the future sequence. Un- like previous CVAE models which use an extra en- coder to encode the response separately (Zhao et al., 2017; Zhou and Wang, 2018) or use a backward RNN to encode the future sequence for each time step (Goyal et al., 2017; Du et al., 2018), SVT uses a Non-causal Multi-head Attention which leaks the future information to the recognition network for computing the posterior latent variables.",
  "As shown in Figure 2, the SVT shares the same encoder as the standard Transformer (Vaswani et al., 2017), while its decoder consists of a vari- ational decoder layer followed by a stack of N standard Transformer decoder layers. The varia- tional decoder layer has two paths for computing the posterior latent variable and prior latent variable respectively. We denote them as Posterior Path and Prior Path. TRS Encoder Multi-head Attention \u00a0Multi-head Attention Recognition Net Prior Net \u00a0Masked Multi- head Attention Layer-norm + + Layer-norm Layer-norm + + Layer-norm Layer-norm z z FFN Layer-norm + Context \u00a0 Response (shifted right) TRS Decoder Layer \u00d7j Generation Attention Mechanism Train only Train & Test c + Sum c Concatenation \u0084l \u0084n Figure 2: The Sequential Variational Transformer.",
  "Dur- ing training, The posterior latent variables z by the pos- terior network are passed to the decoder, while during testing, the target response is absent, and z is replaced by the prior latent variables z. The word embeddings, positional encoding, softmax layer and meta vectors are ignored for simplicity 4.1 Prior Path The Prior Path (solid line in Figure 2) has a masked multi-head self-attention sub-layer which performs causal attention on the shifted response, followed by a multi-head self-attention sub-layer which per- forms encoder-decoder multi-head attention on the context encoder. The last sub-layer is composed of a MLP prior network which approximates a se- quence of prior latent variable for each position, and a Position-wise Feed-Forward Network (FFN) which fuse the latent information z with the ob- served information representation oP before the prior network (shown in Figure 2). Speci\ufb01cally, we concatenate oP with z as the input to the FNN, and the FNN pass the fused representation to the next layer. Same as Vaswani et al.",
  "Speci\ufb01cally, we concatenate oP with z as the input to the FNN, and the FNN pass the fused representation to the next layer. Same as Vaswani et al. (2017), in the variational decoder layer, each sub-layer is fol- lowed by a residual connection and layer normal- ization. That is, the output of each sub-layer is LayerNorm(x + Sublayer(x)).",
  "We decompose the response x as x = (x1, \u00b7 \u00b7 \u00b7 , xT ) and the latent variable z as z = (z1, . . . , zT ). The prior model produces latent vari- ables at each position zt by not only conditioning on the input condition c (the concatenation of con- text and meta features), but also conditioning on the observed response tokens x1:t\u22121. By assum- ing zt follows a multivariate Gaussian distribution, the prior model becomes: p\u03b8 (zt|c, x1:t\u22121) = N \u0000zt; \u00b5\u2032 t, \u03c3\u2032 t \u0001 , (5) where [\u00b5\u2032 t, log \u03c3\u2032 t] = MLP(oP ). 4.2 Posterior Path The only difference between the Posterior Path (dash line in Figure 2) and Prior Path is that the mask is removed from the masked multi-head at- tention. Thus the masked (casual) multi-head attention become non-casual multi-head atten- tion, which allows each position to attend to the subsequent positions.",
  "Thus the masked (casual) multi-head attention become non-casual multi-head atten- tion, which allows each position to attend to the subsequent positions. Then, the second multi-head attention sub-layer (shared the same weight with prior path) performs posterior attention on the en- coder and passes the posterior observed informa- tion oR to the recognition network. The recognition network produces the posterior latent variable for each position zt as: q\u03c6 (zt|c, x) = N (zt; \u00b5t, \u03c3t) , (6) where [\u00b5t, log \u03c3t] = MLP(oR). During the training, the posterior path guides the learning of prior path via KL divergence constraint: LKL = X t KL (q\u03c6(zt|c, x)\u2225p\u03b8(zt|c, x1:t\u22121)) (7) In the training phase, the posterior latent variables from Equation 6 are passed to the FFN, while in the testing phase the Posterior Path will be blocked and the posterior latent variables will be replaced with the prior latent variables from Equation 5.",
  "During the decoding process, each response to- ken xt is generated by conditioning on observed response tokens x1:t\u22121, latent variables z1:t, and the input condition c. The decoding process of the SVT is: p\u03b8(x|z, c) = Y t p\u03b8 (xt|z1:t, x1:t\u22121, c) . (8) 4.3 Auxiliary Loss As we expect the latent variables to be a genera- tion plan for the future sequence, we inject such bias into latent variables by using an auxiliary loss: Sequential-Bag-of-Word (SBOW) which proposed by Du et al. (2018). The idea of the SBOW aux- iliary objective is to sequentially predict the bag of succeeding target words xt:T by using latent variable zt. In our case, the succeeding words pre- diction also leverages the observed information c and x1:t\u22121. Thus the auxiliary loss at each position is computed by: p\u03be(xt:T |zt, c, x1:t\u22121) = faux(zt, oP ) (9) where faux is a feed-forward neural network with the softmax output.",
  "Thus the auxiliary loss at each position is computed by: p\u03be(xt:T |zt, c, x1:t\u22121) = faux(zt, oP ) (9) where faux is a feed-forward neural network with the softmax output. 4.4 Learning The evidence lower bound (ELBO) objective of SVT is the sum of the reconstruction loss LREC(t) and Kullback-Leibler divergence loss LKL(t) at each position: LELBO = X t LREC(t) \u2212LKL(t) = X t Eq\u03c6(zt|c,x) [log p\u03b8(xt|z1:t, x1:t\u22121, c)] \u2212KL (q\u03c6(zt|c, x)\u2225p\u03b8(zt|c, x1:t\u22121)) . (10) We regularize the ELBO learning objective with an auxiliary loss Lsbow to enhance the expressive- ness of the latent variables.",
  "(10) We regularize the ELBO learning objective with an auxiliary loss Lsbow to enhance the expressive- ness of the latent variables. Therefore, the \ufb01nal learning objective is formulated as follows: L = LELBO + Lsbow, (11) where, Lsbow = X t Eq\u03c6(zt|c,x) [log p\u03be(xt:T |zt, x1:t\u22121, c)] . (12) 5 Experiments 5.1 Dataset We evaluate the proposed models on three con- versationet dataset such as MojiTalk (Zhou and Wang, 2018), PersonaChat (Zhang et al., 2018), Empathetic-Dialogues (Rashkin et al., 2019).",
  "MojiTalk dataset consists of 596,959 post and re- sponse pairs from Twitter. Each response is labeled by one emoji which indicates the response emotion. There are 64 emoji labels in total with unbalanced distribution. We use the preprocessed data and vo- cabulary released from Zhou and Wang (2018) and follow the same split of train/validation/test set. PersonaChat & Empathetic-Dialogues are one-to-one multi-turn conversation datasets. In PersonaChat (Persona), the conversations are revolve around personas which are established by four to six persona sentences. While in Empathetic-Dialogues (ED), the conversation are mostly about situation that happened to one of the speaker and another speaker is trying to understand the feeling and reply accordingly. Both datasets are about modeling social skills and the goal is to make user more engaging. Therefore, we combine the train/validation/test set of two datasets. 5.2 Baselines We compare the proposed models with the follow- ing baselines: Seq2Seq. An attention-based sequence-to- sequence model with the emoji vector as additional input as discribed in MojiTalk (Zhou and Wang, 2018). CVAE.",
  "5.2 Baselines We compare the proposed models with the follow- ing baselines: Seq2Seq. An attention-based sequence-to- sequence model with the emoji vector as additional input as discribed in MojiTalk (Zhou and Wang, 2018). CVAE. An RNN-based conditional variational autoencoder for dialogue response genera- tion (Zhou and Wang, 2018), which uses a multivariate Gaussian latent variable to model the response and concatenate it with the last hidden state of the encoder as the initial state of the decoder. KL annealing, early stopping strategy and bag-of-word auxiliary loss are applied during the training. We use the implementation 3 released by Zhou and Wang (2018). Transformer. A transformer (Vaswani et al., 2017) trained by using a Maximum Likelihood Estimation (MLE) objective and can be considered as the base model for both the GVT and SVT. 5.3 Hyper-parameters and Training Setup We use a 4-layer Transformer as our base model.",
  "5.3 Hyper-parameters and Training Setup We use a 4-layer Transformer as our base model. The hidden size is set to be 300 everywhere, and the word embedding is initialized with the 300- dimensional pre-trained GloVe embeddings for 3The implementation of CVAE baseline: https:// github.com/claude-zhou/MojiTalk both encoder and decoder. The multi-head atten- tion sub-layers are made up of 4 attention heads each with embedding dimension 64. The size of latent variable is 300. The recognition network and the prior network are parameterized by 3-layer MLPs with 512 hidden dimension. Following the training setup of Zhou and Wang (2018), we \ufb01rst train our baseline transformer model with the MLE objective and use it to initialize its counterparts in both GVT and SVT. Then the models are trained end-to-end by the Adam optimizer with the ini- tial learning rate 2 \u00d7 10\u22124. KL annealing and early stopping strategy are applied as in (Zhou and Wang, 2018). In the test time, we use greedy decoding strategy for all models.",
  "KL annealing and early stopping strategy are applied as in (Zhou and Wang, 2018). In the test time, we use greedy decoding strategy for all models. 5.4 Automatic Evaluation PPL & KLD. The evaluation metrics include Perplexity (PPL) and Kullback-Leibler divergence between the posterior and prior (KLD). A well trained model should achieve a low reconstruction and small but non-trivial KL distance (Zhao et al., 2018). Diversity. To measure the generation diversity, we calculate Dist-1, Dist-2, and Dist-3, the ratio of the number of distinct n-grams (unigrams, bigrams, and trigrams) over the total number of n-grams. A higher distinct n-grams ratio indicates more diverse generation. Embeddings Similarity. This metric computes the cosine similarity between the sentence embed- ding of a generated sequence and that of a ground- truth response. In our experiments, we introduce two different ways to represent sentence embed- dings.",
  "A higher distinct n-grams ratio indicates more diverse generation. Embeddings Similarity. This metric computes the cosine similarity between the sentence embed- ding of a generated sequence and that of a ground- truth response. In our experiments, we introduce two different ways to represent sentence embed- dings. The \ufb01rst is EMBFT (Liu et al., 2016) that calculates the average of word embeddings in a sen- tence using FastText (Mikolov et al., 2018) which is trained with Common Crawl and Wikipedia data. We use FastText embeddings instead of other pre- trained word embeddings because it can handle out- of-vocabulary issue. However, representing a sen- tence by simply taking the average of word embed- dings ignores the context information. Therefore, we propose to use a pre-trained language model BERT (Devlin et al., 2018) to compute the con- textualized sentence representation. Speci\ufb01cally, we use a pre-trained BERT to encode a generated sentence and a ground-truth response, and average the output representation of both to obtain the sen- tence embeddings.",
  "Speci\ufb01cally, we use a pre-trained BERT to encode a generated sentence and a ground-truth response, and average the output representation of both to obtain the sen- tence embeddings. We denote such contextualized sentence embedding as EMBBERT.",
  "MojiTalk Model PPL KLD Diversity Embeddings Similarity Human Evaluation Dist-1 Dist-2 Dist-3 EMBFT EMBBERT Coherence Emotion Seq2Seq 130.75 - 0.0055 0.0187 0.0347 0.738 0.594 20.67 20.67 CVAE 35.33 27.55 0.0189 0.1340 0.3640 0.751 0.613 18.33 18 Transformer 72.66 - 0.0040 0.0161 0.0324 0.741 0.596 19.67 23.33 GVT 19.71 18.15 0.0207 0.1524 0.4064 0.753 0.609 23 22.67 SVT 18.96 32.27 0.0079 0.1053 0.3654 0.762 0.619 26 27.67 Human - - 0.0557 0.4009 0.",
  "609 23 22.67 SVT 18.96 32.27 0.0079 0.1053 0.3654 0.762 0.619 26 27.67 Human - - 0.0557 0.4009 0.7697 - - - - Persona + ED Model PPL KLD Diversity Embeddings Similarity Human Evaluation Dist-1 Dist-2 Dist-3 EMBFT EMBBERT Coherence Engagedness CVAE 31.32 10.01 0.0186 0.1102 0.295 0.917 0.666 20.67 21.33 Transformer 48.03 - 0.0058 0.0237 0.0524 0.915 0.672 24.67 24.67 GVT 18.34 19.13 0.0204 0.1406 0.3995 0.917 0.675 20 21.33 SVT 17.75 24.67 0.0213 0.1521 0.3936 0.906 0.665 38.",
  "0204 0.1406 0.3995 0.917 0.675 20 21.33 SVT 17.75 24.67 0.0213 0.1521 0.3936 0.906 0.665 38.67 36.67 Human - - 0.0640 0.3800 0.7070 - - - - Table 1: Results of Variational Transformer compared to baselines on automatic and human evaluations. 5.5 Human Evaluation In the human evaluation, we prepare multiple- choice questions for human evaluators and the an- swers are the generation results from the \ufb01ve mod- els (Seq2Seq, CVAE, Transformer, GVT, and SVT). we \ufb01rst randomly sample 100 dialogues and their corresponding responses from our models and the baselines. For each response, we assign three hu- man annotators to select the most coherent (on topic) response to the context (multiple answers are allowed).",
  "we \ufb01rst randomly sample 100 dialogues and their corresponding responses from our models and the baselines. For each response, we assign three hu- man annotators to select the most coherent (on topic) response to the context (multiple answers are allowed). In addition, annotators also need to choose the best response correlated to the given emoji label in Mojitalk and the most engaging re- sponse in PersonaChat and Empathetic-Dialogues. If there is no response that satis\ufb01es the evalua- tors, they can choose \u201call answers are bad\u201d, which means none of the answer is chosen. We compute the rate that each model is chosen to quantify gen- eration quality regarding to the human standard. 6 Results 6.1 Quantitative Analysis The automatic evaluation results are shown in Ta- ble 1. Transformer-based models have signi\ufb01cantly lower perplexity compared to RNN-based models which indicate that the global receptive \ufb01eld per- formed by multi-head self-attention boost the mod- eling capacity. However, deterministic Seq2Seq and Transformer models tends to generate generic responses which leads to a low diversity score.",
  "However, deterministic Seq2Seq and Transformer models tends to generate generic responses which leads to a low diversity score. Meanwhile incorporating a stochastic latent vari- able into both models (CVAE and GVT) promote more diverse generation results and boost the diver- sity scores such as Dist-1, Dist-2, and Dist-3. Compare to baseline models, the GVT achieves relatively lower reconstruction PPL, which sug- gests that the global latent variable contains rich latent information (e.g., topic) for response gener- ation. Meanwhile, the sequential latent variables of the SVT encode \ufb01ne-grained latent information and further improve the reconstruction PPL. On the other hand, SVT achieves the highest score in terms of two semantic relevance-oriented metrics such as EMBFT and EMBBERT in Mo- jiTalk dataset, while in the combined dataset of Persona and ED, we observe performance drop of SVT compare to other models. This is because both Persona and ED are well designed and have lower entropy than MojiTalk which collected from Twitter. We hypothesize that the sequential latent variables have no advantage in term of similarity to single, \ufb01xed \u201dgold response\u201d when model low entropy response.",
  "This is because both Persona and ED are well designed and have lower entropy than MojiTalk which collected from Twitter. We hypothesize that the sequential latent variables have no advantage in term of similarity to single, \ufb01xed \u201dgold response\u201d when model low entropy response. Indeed, in open domain dia- logue response generation, automatic metric is not always aligned with the human judgement (Liu et al., 2016). In contrast, human evaluation result reported in Table 1 demonstrates the generations of SVT are closer to the human standard in terms of coherence, invoked emotion and engagedness. 6.2 Qualitative Analysis Table 2 compares the generation of the proposed models with baselines given the same contexts. We observe that the Seq2Seq and vanilla transformer tend to generate generic and repetitive responses",
  "Context trade must \u2019ve made you mad ? Emotion Responses Seq2Seq: i \u2019m not sure if i \u2019m not sure if i \u2019m not sure if i \u2019m not sure about it CVAE: <unk> but i don \u2019t think it \u2019s been on Transformer: i \u2019m not sure i \u2019m not GVT: i \u2019ll pass it on , she \u2019s mad SVT: hell yeah bro . yeah Ref: i don \u2019t wanna talk about it Context love the smell of a good bbq ! Emotion Responses Seq2Seq: i love it ! i love it ! CVAE: aw you \u2019re getting better Transformer: i \u2019m glad you like it ! GVT: i \u2019d like to know you \u2019re very well . SVT: omg what kind of smell ? thanks for sharing it with a pizza in <unk> Ref: hahaha that sounds like friday to me pc Context good evening , how are you tonight ? Responses CVAE: hi , i am doing well . you ? Transformer: i am doing well , how are you ? GVT: i am good . just studying some people there .",
  "Responses CVAE: hi , i am doing well . you ? Transformer: i am doing well , how are you ? GVT: i am good . just studying some people there . SVT: : i am doing well , just \ufb01nished eating some ice cream . Ref: i am doing well . i am relaxing before bed . i work in the morning . Context i cook mine at home while watching one tree hill . love that show . Responses CVAE: i love to cook . i like to cook . Transformer: i love the outdoors . i love the outdoors . GVT:it is good . . . you can make some money . SVT: do you have any pets ? i have never watched any of tv. Ref: i am looking for a new job . i hate sitting still all day User: well do you work ? do you have a degree to sustain yourself ? Context System: i built models when i was a kid . now i sculpt and mold and carve. User: nice , i specialize in computer science degree so i mostly mold 3d images.",
  "do you have a degree to sustain yourself ? Context System: i built models when i was a kid . now i sculpt and mold and carve. User: nice , i specialize in computer science degree so i mostly mold 3d images. Responses CVAE: i do not like it when you get to do the same Transformer: i am a teacher . i am a teacher . i am a teacher . GVT: me too ! my favorite is the best baker . SVT: i love the technology . i like to play when i get older Ref: i am looking for a new job . i hate sitting still all day Table 2: Generated responses from proposed models and baseline models. The reference responses (Ref) are given. (e.g., i am not sure) in MojiTalk due to their de- terministic structure fail to capture the variability in dialogue response. By incorporating stochastic latent variables, the CVAE and GVT can gener- ate more diverse responses, but their responses are sometimes digressive (e.g., example 5).",
  "By incorporating stochastic latent variables, the CVAE and GVT can gener- ate more diverse responses, but their responses are sometimes digressive (e.g., example 5). Interest- ingly, GVT and SVT generalize the topic beyong the context which make the dialogue more engag- ing (e.g., example 4). In general, SVT is able to generate more coherent and informative responses. 7 Conclusion This paper introduces the Variational Transformer (VT), a variational self-attentive feed-forward se- quence model that combines the global receptive \ufb01eld of a Transformer with the variational nature of a CVAE. We propose two types of the VT: 1) the Global Variational Transformer (GVT) which incorporates a global latent variable as additional input to the transformer decoder; and 2) the Sequen- tial Variational Transformer (SVT) which generates latent variables for each position during decoding process. Quantitative and qualitative experimental results shows that our models outperform baselines in terms of diversity, semantic relevance, and hu- man judgment.",
  "Quantitative and qualitative experimental results shows that our models outperform baselines in terms of diversity, semantic relevance, and hu- man judgment. In future work, we will utilize the pre-training language models (Radford et al., 2019) as the back-bone to strengthen the language model of the VT for better generation.",
  "References Samuel R Bowman, Luke Vilnis, Oriol Vinyals, An- drew Dai, Rafal Jozefowicz, and Samy Bengio. 2016. Generating sentences from a continuous space. In Proceedings of The 20th SIGNLL Confer- ence on Computational Natural Language Learning. Junyoung Chung, Kyle Kastner, Laurent Dinh, Kratarth Goel, Aaron C Courville, and Yoshua Bengio. 2015. A recurrent latent variable model for sequential data. In Advances in neural information processing sys- tems, pages 2980\u20132988. Mostafa Dehghani, Stephan Gouws, Oriol Vinyals, Jakob Uszkoreit, and \u0141ukasz Kaiser. 2018. Univer- sal transformers. arXiv preprint arXiv:1807.03819. Jacob Devlin, Ming-Wei Chang, Kenton Lee, and Kristina Toutanova. 2018. Bert: Pre-training of deep bidirectional transformers for language understand- ing. arXiv preprint arXiv:1810.04805.",
  "Jacob Devlin, Ming-Wei Chang, Kenton Lee, and Kristina Toutanova. 2018. Bert: Pre-training of deep bidirectional transformers for language understand- ing. arXiv preprint arXiv:1810.04805. Jiachen Du, Wenjie Li, Yulan He, Ruifeng Xu, Lidong Bing, and Xuan Wang. 2018. Variational autoregres- sive decoder for neural response generation. In Pro- ceedings of the 2018 Conference on Empirical Meth- ods in Natural Language Processing, pages 3154\u2013 3163. Anirudh Goyal Alias Parth Goyal, Alessandro Sor- doni, Marc-Alexandre C\u02c6ot\u00b4e, Nan Rosemary Ke, and Yoshua Bengio. 2017. Z-forcing: Training stochas- tic recurrent networks. In Advances in neural infor- mation processing systems, pages 6713\u20136723.",
  "2017. Z-forcing: Training stochas- tic recurrent networks. In Advances in neural infor- mation processing systems, pages 6713\u20136723. Lukasz Kaiser, Samy Bengio, Aurko Roy, Ashish Vaswani, Niki Parmar, Jakob Uszkoreit, and Noam Shazeer. 2018. Fast decoding in sequence models using discrete latent variables. In International Con- ference on Machine Learning, pages 2395\u20132404. Lukasz Kaiser, Aidan N Gomez, Noam Shazeer, Ashish Vaswani, Niki Parmar, Llion Jones, and Jakob Uszkoreit. 2017. One model to learn them all. arXiv preprint arXiv:1706.05137. Diederik P Kingma and Max Welling. 2013. Auto- encoding variational bayes. arXiv preprint arXiv:1312.6114. Hung Le, Truyen Tran, Thin Nguyen, and Svetha Venkatesh. 2018. Variational memory encoder- decoder.",
  "2013. Auto- encoding variational bayes. arXiv preprint arXiv:1312.6114. Hung Le, Truyen Tran, Thin Nguyen, and Svetha Venkatesh. 2018. Variational memory encoder- decoder. In Advances in Neural Information Pro- cessing Systems, pages 1508\u20131518. Jiwei Li, Michel Galley, Chris Brockett, Jianfeng Gao, and Bill Dolan. 2016a. A diversity-promoting ob- jective function for neural conversation models. In Proceedings of NAACL-HLT, pages 110\u2013119. Jiwei Li, Michel Galley, Chris Brockett, Georgios Sp- ithourakis, Jianfeng Gao, and Bill Dolan. 2016b. A persona-based neural conversation model. In Pro- ceedings of the 54th Annual Meeting of the Associa- tion for Computational Linguistics (Volume 1: Long Papers), pages 994\u20131003. Piji Li, Wai Lam, Lidong Bing, and Zihao Wang. 2017.",
  "In Pro- ceedings of the 54th Annual Meeting of the Associa- tion for Computational Linguistics (Volume 1: Long Papers), pages 994\u20131003. Piji Li, Wai Lam, Lidong Bing, and Zihao Wang. 2017. Deep recurrent generative decoder for abstractive text summarization. In Proceedings of the 2017 Con- ference on Empirical Methods in Natural Language Processing, pages 2091\u20132100. Zhaojiang Lin, Andrea Madotto, Jamin Shin, Peng Xu, and Pascale Fung. 2019. Moel: Mixture of empa- thetic listeners. In Proceedings of the 2019 Con- ference on Empirical Methods in Natural Language Processing and the 9th International Joint Confer- ence on Natural Language Processing (EMNLP- IJCNLP), pages 121\u2013132. Chia-Wei Liu, Ryan Lowe, Iulian Serban, Mike Nose- worthy, Laurent Charlin, and Joelle Pineau. 2016.",
  "Chia-Wei Liu, Ryan Lowe, Iulian Serban, Mike Nose- worthy, Laurent Charlin, and Joelle Pineau. 2016. How not to evaluate your dialogue system: An em- pirical study of unsupervised evaluation metrics for dialogue response generation. In Proceedings of the 2016 Conference on Empirical Methods in Natural Language Processing, pages 2122\u20132132. Tomas Mikolov, Edouard Grave, Piotr Bojanowski, Christian Puhrsch, and Armand Joulin. 2018. Ad- vances in pre-training distributed word representa- tions. In Proceedings of the International Confer- ence on Language Resources and Evaluation (LREC 2018). Niki Parmar, Ashish Vaswani, Jakob Uszkoreit, Lukasz Kaiser, Noam Shazeer, Alexander Ku, and Dustin Tran. 2018. Image transformer. In International Conference on Machine Learning, pages 4052\u2013 4061. Alec Radford, Jeffrey Wu, Rewon Child, David Luan, Dario Amodei, and Ilya Sutskever. 2019.",
  "2018. Image transformer. In International Conference on Machine Learning, pages 4052\u2013 4061. Alec Radford, Jeffrey Wu, Rewon Child, David Luan, Dario Amodei, and Ilya Sutskever. 2019. Language models are unsupervised multitask learners. OpenAI Blog, 1(8). Hannah Rashkin, Eric Michael Smith, Margaret Li, and Y-Lan Boureau. 2019. Towards empathetic open- domain conversation models: A new benchmark and dataset. In Proceedings of the 57th Annual Meet- ing of the Association for Computational Linguistics, pages 5370\u20135381. Iulian Vlad Serban, Ryan Lowe, Laurent Charlin, and Joelle Pineau. 2016. Generative deep neural net- works for dialogue: A short review. arXiv preprint arXiv:1611.06216. Iulian Vlad Serban, Alessandro Sordoni, Ryan Lowe, Laurent Charlin, Joelle Pineau, Aaron Courville, and Yoshua Bengio. 2017.",
  "arXiv preprint arXiv:1611.06216. Iulian Vlad Serban, Alessandro Sordoni, Ryan Lowe, Laurent Charlin, Joelle Pineau, Aaron Courville, and Yoshua Bengio. 2017. A hierarchical latent variable encoder-decoder model for generating dialogues. In Thirty-First AAAI Conference on Arti\ufb01cial Intelli- gence. Kihyuk Sohn, Honglak Lee, and Xinchen Yan. 2015. Learning structured output representation using deep conditional generative models. In Advances in neural information processing systems, pages 3483\u2013 3491.",
  "Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, \u0141ukasz Kaiser, and Illia Polosukhin. 2017. Attention is all you need. In Advances in neural information pro- cessing systems, pages 5998\u20136008. Oriol Vinyals and Quoc Le. 2015. A neural conversa- tional model. arXiv preprint arXiv:1506.05869. Richard S Wallace. 2009. The anatomy of alice. In Parsing the Turing Test, pages 181\u2013210. Springer. Joseph Weizenbaum et al. 1966. Eliza\u2014a computer program for the study of natural language communi- cation between man and machine. Communications of the ACM, 9(1):36\u201345. Biao Zhang, Deyi Xiong, Hong Duan, Min Zhang, et al. 2016. Variational neural machine translation.",
  "Communications of the ACM, 9(1):36\u201345. Biao Zhang, Deyi Xiong, Hong Duan, Min Zhang, et al. 2016. Variational neural machine translation. In Proceedings of the 2016 Conference on Empiri- cal Methods in Natural Language Processing, pages 521\u2013530. Saizheng Zhang, Emily Dinan, Jack Urbanek, Arthur Szlam, Douwe Kiela, and Jason Weston. 2018. Per- sonalizing dialogue agents: I have a dog, do you have pets too? In Proceedings of the 56th An- nual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers), pages 2204\u2013 2213. Tiancheng Zhao, Kyusong Lee, and Maxine Eskenazi. 2018. Unsupervised discrete sentence representa- tion learning for interpretable neural dialog genera- tion. In Proceedings of the 56th Annual Meeting of the Association for Computational Linguistics (Vol- ume 1: Long Papers), pages 1098\u20131107.",
  "2018. Unsupervised discrete sentence representa- tion learning for interpretable neural dialog genera- tion. In Proceedings of the 56th Annual Meeting of the Association for Computational Linguistics (Vol- ume 1: Long Papers), pages 1098\u20131107. Tiancheng Zhao, Ran Zhao, and Maxine Eskenazi. 2017. Learning discourse-level diversity for neural dialog models using conditional variational autoen- coders. In Proceedings of the 55th Annual Meet- ing of the Association for Computational Linguistics (Volume 1: Long Papers), pages 654\u2013664. Xianda Zhou and William Yang Wang. 2018. Mojitalk: Generating emotional responses at scale. In Pro- ceedings of the 56th Annual Meeting of the Associa- tion for Computational Linguistics (Volume 1: Long Papers), pages 1128\u20131137."
]